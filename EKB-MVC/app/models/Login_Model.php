<?php
	/**
	 * 
	 */
	class Login_Model extends Base_Model
	{
		function login($userData){
			extract($userData);
			$sql = "SELECT id,username,level FROM tbuser WHERE username=? AND password=?";
			$stmt= $this->conn->prepare($sql);
			$stmt->bind_param("ss", $uname, $pass);
			$stmt->execute(); 
			$stmt->bind_result($colId, $colUname, $colLevel);
			$stmt->store_result();
			$stmt->fetch();
			
			if($stmt->num_rows === 1){
				$_SESSION["loged"] = true;
				$_SESSION['id'] = $colId;
				$_SESSION['username'] = $colUname;
				$_SESSION['level'] = $colLevel;
				$url =BASE_URL.'?module=home&action=index';
				header("location: $url");
				setcookie('login', 'Logged in successfully', time()+1, "/");
			}
			else{
				$url =BASE_URL.'?module=login&action=index';
				header("location: $url");
				setcookie('login', 'Login failed', time()+1, "/");
			}
		}

		function logout(){
			setcookie('logout', 'Logged out successfully', time()+6, "/");
			session_destroy();
			$url =BASE_URL.'?module=home&action=index';
			header("location: $url");
		}
	}
?>