<?php
	/**
	 * 
	 */
	class Home_Controller extends Base_Controller  {
		function index(){
			if(empty($_GET['page'])){	//lấy số trang hiện tại 
				$page = 1;
			}else{
				$page = $_GET['page']; 
			}
			$fromRecord = ($page - 1)*N;
			$this->model->load('record');
			$getData = $this->model->record->getAll($fromRecord);
			$this->view->load('home/index', $getData);

			$paginationData = $this->model->record->numRecord();
			$this->view->load('pagination', $paginationData);
		}

		function export(){
			if(!isset($_SESSION["loged"])){
				$url =BASE_URL.'?module=home&action=index';
				header("location: $url");
				setcookie('permissions', 'You are not logged in', time()+1, "/");
			}else{
				$this->model->load('record');
				$this->model->record->exportCVE($_GET['id']);

				$url =BASE_URL.'?module=home&action=index';
				header("location: $url");

				//$getData = $this->model->record->getAll();
				//$this->view->load('home/index', $getData);
			}
		}

		function deleteRecord(){
			if(!isset($_SESSION["loged"])){
				$url =BASE_URL.'?module=home&action=index';
				header("location: $url");
				setcookie('permissions', 'You need to be logged in to perform this function', time()+1, "/");
			}else{
				if($_SESSION['level'] != 1){
					$url =BASE_URL.'?module=home&action=index';
					header("location: $url");
					setcookie('permissions', 'You are not authorized to perform this function', time()+1, "/");
				}else{
					$this->model->load('record');
					$table = 'tbcve';
					$this->model->record->delete($table, $_GET['id']);

					$url =BASE_URL.'?module=home&action=index';
					header("location: $url");

					//$getData = $this->model->record->getAll();
					//$this->view->load('home/index', $getData);							
				}
			}
				
		}

	}
?>