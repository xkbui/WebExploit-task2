<?php
	/**
	 * 
	 */
	class Update_Controller extends Base_Controller
	{	
		function index(){
			if(!isset($_SESSION["loged"])){
				$url =BASE_URL.'?module=home&action=index';
				header("location: $url");
				setcookie('permissions', 'You need to be logged in to perform this function', time()+1, "/");
			}else{
				if($_SESSION['level'] != 1){
					$url =BASE_URL.'?module=home&action=index';
					header("location: $url");
					setcookie('permissions', 'You are not authorized to perform this function', time()+1, "/");
				}else{
					$this->model->load('record');
					$getData = $this->model->record->findOneCVE ($_GET['id']);
					$this->view->load('update/index', $getData);
					$this->view->load('show', $getData);

					if ($_SERVER["REQUEST_METHOD"] == "POST"){
						$recordData = [
							'id' => $_GET['id'],
							'title' => filter_var($_POST['title'], FILTER_SANITIZE_STRING),	// xử dụng filter để vệ sinh dữ liệu đầu vào
							'cve' => filter_var($_POST['cve'], FILTER_SANITIZE_STRING),	// FILTER_SANITIZE_STRING xóa các kí tự <> </>
							'osvdb' => filter_var($_POST['osvdb'], FILTER_SANITIZE_STRING),
							'author' => filter_var($_POST['author'], FILTER_SANITIZE_STRING),
							'published' => filter_var($_POST['published'], FILTER_SANITIZE_STRING),
							'impact' => filter_var($_POST['impact'], FILTER_SANITIZE_STRING),
							'platform' => filter_var($_POST['platform'], FILTER_SANITIZE_STRING),
							'file' => filter_var($_POST['file'], FILTER_SANITIZE_STRING),
							'url' => filter_var($_POST['url'], FILTER_SANITIZE_STRING)
						];

						$this->model->record->updateCVE($recordData);
					}
				}
			}
		}
	}
?>