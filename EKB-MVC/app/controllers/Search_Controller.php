<?php
	/**
	 * 
	 */
	class Search_Controller extends Base_Controller
	{
		
		function index(){
			$this->model->load('record');
			//$getData = $this->model->record->getAll();
			$this->view->load('search/index');
			if(empty($_GET['page'])){	//lấy số trang hiện tại 
				$page = 1;
			}else{
				$page = $_GET['page']; 
			}
			$fromRecord = ($page - 1)*N;

			if($_SERVER["REQUEST_METHOD"] == "POST"){
				if(isset($_POST['title'])){
					$title = "%".$_POST['title']."%";
				}else{
					$title = "%%";
				}
				if(isset($_POST['cve'])){
					$cve = "%".$_POST['cve']."%";
				}else{
					$cve = "%%";
				}
 				if(isset($_POST['osvdb'])){
 					$osvdb = "%".$_POST['osvdb']."%";
 				}else{
 					$osvdb = "%%";
 				}
 				if(isset($_POST['author'])){
 					$author = "%".$_POST['author']."%";
 				}else{
 					$author = "%%";
 				}
 				if(isset($_POST['published'])){
 					$published = "%".$_POST['published']."%";
 				}else{
 					$published = "%%";
 				}
 				if(isset($_POST['impact'])){
 					$impact = "%".$_POST['impact']."%"; 
 				}else{
 					$impact = "%%";
 				}
 				if(isset($_POST['platform'])){
 					$platform = "%".$_POST['platform']."%";
 				}else{
 					$platform = "%%";
 				}

 				$keySearch = [
					'title' => $title,	
					'cve' => $cve,	
					'osvdb' => $osvdb,
					'author' => $author,
					'published' => $published,
					'impact' => $impact,
					'platform' => $platform,
					'fromRecord' => $fromRecord
				];

				if(!empty($this->model->record->searchCVE($keySearch))){
					$getData = $this->model->record->searchCVE($keySearch);
					$this->view->load('show', $getData);

					$paginationData = $this->model->record->numRecordSearch($keySearch);
					$this->view->load('pagination', $paginationData);
				}else{
					echo "<script>alert('Record not found !')</script>";
				}
			}	
		}
	}
?>