<?php
	class Base_Model extends Core_Model {
		function getAll($fromRecord){
			$n = N; // Số tin trên trang
			$sql = "SELECT * FROM tbcve ORDER BY id DESC LIMIT ?, ?";
			$stmt= $this->conn->prepare($sql);
 			$stmt->bind_param("ii", $fromRecord, $n);
			$stmt->execute(); 
			$stmt->bind_result($colId, $colTitle,  $colCve, $colOsvdb, $colAuthor, $colPublished, $colImpact, $colPlatform, $colFile, $colUrl);
			$stmt->store_result();
	
			// Chuyển dữ liệu truy vấn thành Associative Array với các value là các Associative Array con 
 			if($stmt->num_rows > 0){
				while($stmt->fetch()){
					$arrData[] = [
						'id' => $colId,
						'title' => $colTitle,
						'cve' =>  $colCve,
						'osvdb' => $colOsvdb,
						'author' => $colAuthor,
						'published' => $colPublished,
						'impact' => $colImpact,
						'platform' => $colPlatform,
						'file' => $colFile,
						'url' => $colUrl,
					];	
				}
			}
			return $arrData;
		}

		function findOneId($table, $id){
			$sql = "SELECT * FROM $table WHERE id=?";
			$stmt = $this->conn->prepare($sql);
			$stmt->bind_param("s", $id);
			$stmt->execute();
			$stmt->store_result();
			
			return $stmt;
			$stmt->close();
		}

		function delete($table, $id){

			$sql = "DELETE FROM $table WHERE id=?";
			$stmt = $this->conn->prepare($sql);
			$stmt->bind_param("s", $id);
			$t = $stmt->execute();
			if($stmt->execute() === TRUE){
				setcookie('execute', 'Record has been deleted successfully', time()+1, "/");
				//echo "<script>alert('Record has been deleted successfully')</script>";
			}else{

				//echo "<script>alert(",$this->conn->error,")</script>";
				setcookie('execute', 'Error'.$this->conn->error, time()+1, "/");
			}

			$stmt->close();
		}

		/*function insert($table, $userData){
			echo "<br> table:  ",$table;
			echo "<br> So pt:  ",count($userData);
			//var_dump($userData);
			extract($userData);
			$pro = "";
			$val = "";
			$proStr = "";
			$bindStr = "";
			foreach ($userData as $key => $value) {
				$pro = $pro.', '.$key;
				$proStr = $proStr.', $'.$key;
				$val = $val."?";
				$bindStr = $bindStr.'s';

				
			}
			echo "<br> >>>",$pro,"0000 ",$val, "<<<< ", $proStr;
			echo "<br>",$bindStr," @@@@", $uname;

			$sql = "INSERT INTO ".$table." (".$pro.") VALUES (".$val.")";
		}*/
	}
?>